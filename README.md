# infx_w client

## build instructions
cargo build --release

## Help
./write_avail --help
Influxdb2 point client

Usage: write_avail --target-json <TARGET_JSON> --measurement-json <MEASUREMENT_JSON>

Options:
  -t, --target-json <TARGET_JSON>            endpoint target
  -m, --measurement-json <MEASUREMENT_JSON>  influx measurements
  -h, --help                                 Print help
  -V, --version                              Print version

## Optimization Notes

### 1st pass Duty Cycle optimization
time ./write_avail -t ./nfx.db.json -m ./measurements.1k.json
```
real    0m0.313s
user    0m0.016s
sys     0m0.010s
```

### 1st pass Network optimization
strace -r -e recvfrom,sendto ./write_avail -t ./nfx.db.json -m ./measurements.2.json
```
     0.000000 sendto(9, "\26\3\1\2\0\1\0\1\374\3\3[\341\241OfuyB\334\231YyF\230\24\246#5\ru\376"..., 517, MSG_NOSIGNAL, NULL, 0) = 517
     0.032285 recvfrom(9, "\26\3\3\0z", 5, 0, NULL, NULL) = 5
     0.000448 recvfrom(9, "\2\0\0v\3\3 3#Dx[\263\326\235\311<w\272\255n\326\317\333z\302-\7\34/e\315"..., 122, 0, NULL, NULL) = 122
     0.000674 recvfrom(9, "\24\3\3\0\1", 5, 0, NULL, NULL) = 5
     0.000336 recvfrom(9, "\1", 1, 0, NULL, NULL) = 1
     0.000165 recvfrom(9, "\27\3\3\0\33", 5, 0, NULL, NULL) = 5
     0.000221 recvfrom(9, "\21\321\6\242\361\r\357\3303\240i\364?\333\f\362\235}\f)8@\316HTeK", 27, 0, NULL, NULL) = 27
     0.000191 recvfrom(9, "\27\3\3\17\374", 5, 0, NULL, NULL) = 5
     0.000098 recvfrom(9, "\3 Z8\35\232\341)\264\2\27\312\26\300{ANg\n\261\2504,x\361w\356 \204K\343\334"..., 4092, 0, NULL, NULL) = 4092
     0.001931 recvfrom(9, "\27\3\3\1\31", 5, 0, NULL, NULL) = 5
     0.000110 recvfrom(9, "T\352e \2\376\371\370\201\367j\245\237\23$\6\271[\300\216\305\255d\231\3739z\7\234\303\306\37"..., 281, 0, NULL, NULL) = 281
     0.000260 recvfrom(9, "\27\3\3\0E", 5, 0, NULL, NULL) = 5
     0.000505 recvfrom(9, "aL\3308\25\204\363\332\361\313\202\257\213i\224\272\340\10\f\266\253\337/ \223ZMw\301\331Y\213"..., 69, 0, NULL, NULL) = 69
     0.000552 sendto(9, "\24\3\3\0\1\1\27\3\3\0E\316\207\6\321\5w6\243\327\0046\343\310\206\313\357]\362\215y\223"..., 80, MSG_NOSIGNAL, NULL, 0) = 80
     0.120964 +++ exited with 0 +++
```

### 1st pass Memory optimization
strace -r ./write_avail   -t ./nfx.db.json -m ./measurements.2.json 2>&1 | grep -e mmap -e brk
```
     0.001019 brk(NULL)                 = 0x5630841b5000
     0.000193 mmap(NULL, 34603, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f2185868000
     0.000089 mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f2185866000
     0.000096 mmap(NULL, 600368, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f21857d3000
     0.000199 mmap(0x7f21857f0000, 319488, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1d000) = 0x7f21857f0000
     0.000205 mmap(0x7f218583e000, 106496, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x6b000) = 0x7f218583e000
     0.000154 mmap(0x7f2185859000, 53248, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x85000) = 0x7f2185859000
     0.000094 mmap(NULL, 3100624, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f21854de000
     0.000081 mmap(0x7f2185564000, 1736704, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x86000) = 0x7f2185564000
     0.000097 mmap(0x7f218570c000, 593920, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x22e000) = 0x7f218570c000
     0.000152 mmap(0x7f218579d000, 204800, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x2be000) = 0x7f218579d000
     0.000106 mmap(0x7f21857cf000, 16336, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f21857cf000
     0.000175 mmap(NULL, 103496, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f21854c4000
     0.000092 mmap(0x7f21854c7000, 69632, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x3000) = 0x7f21854c7000
     0.000156 mmap(0x7f21854d8000, 16384, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x14000) = 0x7f21854d8000
     0.000117 mmap(0x7f21854dc000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x17000) = 0x7f21854dc000
     0.000096 mmap(NULL, 136304, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f21854a2000
     0.000105 mmap(0x7f21854a8000, 65536, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x6000) = 0x7f21854a8000
     0.000096 mmap(0x7f21854b8000, 24576, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x16000) = 0x7f21854b8000
     0.000098 mmap(0x7f21854be000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1b000) = 0x7f21854be000
     0.000106 mmap(0x7f21854c0000, 13424, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f21854c0000
     0.000085 mmap(NULL, 1323280, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f218535e000
     0.000081 mmap(0x7f218536b000, 630784, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0xd000) = 0x7f218536b000
     0.000132 mmap(0x7f2185405000, 634880, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0xa7000) = 0x7f2185405000
     0.000170 mmap(0x7f21854a0000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x141000) = 0x7f21854a0000
     0.000085 mmap(NULL, 20752, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f2185358000
     0.000083 mmap(0x7f2185359000, 8192, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1000) = 0x7f2185359000
     0.000109 mmap(0x7f218535b000, 4096, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x3000) = 0x7f218535b000
     0.000107 mmap(0x7f218535c000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x3000) = 0x7f218535c000
     0.000083 mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f2185356000
     0.000093 mmap(NULL, 1918592, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f2185181000
     0.000099 mmap(0x7f21851a3000, 1417216, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x22000) = 0x7f21851a3000
     0.000108 mmap(0x7f21852fd000, 323584, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x17c000) = 0x7f21852fd000
     0.000113 mmap(0x7f218534c000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1ca000) = 0x7f218534c000
     0.000109 mmap(0x7f2185352000, 13952, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f2185352000
     0.000152 mmap(NULL, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f218517e000
     0.000078 mmap(NULL, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_STACK, -1, 0) = 0x7f218586e000
     0.000182 brk(NULL)                 = 0x5630841b5000
     0.000070 brk(0x5630841d6000)       = 0x5630841d6000
     0.000088 mmap(NULL, 2101248, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_STACK, -1, 0) = 0x7f2184f7d000
     0.000307 mmap(NULL, 2101248, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_STACK, -1, 0) = 0x7f2184d7c000
     0.000083 mmap(NULL, 2101248, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_STACK, -1, 0) = 0x7f2184b7b000
     0.000161 mmap(NULL, 2101248, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_STACK, -1, 0) = 0x7f2184977000
     0.001469 brk(0x5630841f7000)       = 0x5630841f7000
     0.000562 brk(0x563084218000)       = 0x563084218000
     0.000366 brk(0x563084239000)       = 0x563084239000
     0.000181 brk(0x56308425a000)       = 0x56308425a000
     0.000193 brk(0x563084258000)       = 0x563084258000
     0.000563 brk(0x563084279000)       = 0x563084279000
     0.000110 brk(0x56308429a000)       = 0x56308429a000
     0.000189 brk(0x563084299000)       = 0x563084299000
     0.000483 brk(0x5630842ba000)       = 0x5630842ba000
     0.000347 brk(0x5630842b9000)       = 0x5630842b9000
     0.000824 brk(0x5630842da000)       = 0x5630842da000
     0.000395 brk(0x5630842fe000)       = 0x5630842fe000
     0.000497 brk(0x56308431f000)       = 0x56308431f000
     0.000411 brk(0x563084340000)       = 0x563084340000
     0.000476 brk(0x563084361000)       = 0x563084361000
     0.000467 brk(0x563084394000)       = 0x563084394000
     0.000607 brk(0x5630843b5000)       = 0x5630843b5000
     0.000480 brk(0x5630843d6000)       = 0x5630843d6000
     0.000438 brk(0x5630843f7000)       = 0x5630843f7000
     0.000436 brk(0x563084418000)       = 0x563084418000
     0.000605 mmap(NULL, 2101248, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_STACK, -1, 0) = 0x7f2184773000
     0.000270 brk(0x56308443c000)       = 0x56308443c000
```     
